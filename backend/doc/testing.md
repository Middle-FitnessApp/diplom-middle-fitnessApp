# üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

## –û–±–∑–æ—Ä

–ü—Ä–æ–µ–∫—Ç –≤–∫–ª—é—á–∞–µ—Ç –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º Vitest –¥–ª—è –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è –∫–∞—á–µ—Å—Ç–≤–∞ API –∏ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏.

## –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤

### –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

```bash
# –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤
npm run test

# –ó–∞–ø—É—Å–∫ —Å –ø–æ–∫—Ä—ã—Ç–∏–µ–º –∫–æ–¥–∞
npm run test:coverage

# –ó–∞–ø—É—Å–∫ –≤ —Ä–µ–∂–∏–º–µ –Ω–∞–±–ª—é–¥–µ–Ω–∏—è (watch mode)
npm run test:watch

# –ó–∞–ø—É—Å–∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Ñ–∞–π–ª–∞ —Ç–µ—Å—Ç–æ–≤
npm run test -- tests/progress/progress.test.ts
```

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–µ—Å—Ç–æ–≤

–¢–µ—Å—Ç—ã –æ—Ä–≥–∞–Ω–∏–∑–æ–≤–∞–Ω—ã –≤ –ø–∞–ø–∫–µ `tests/` –∏ —Å–ª–µ–¥—É—é—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä–µ API:

```
tests/
‚îú‚îÄ‚îÄ setup.ts              # –ì–ª–æ–±–∞–ª—å–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ —Ç–µ—Å—Ç–æ–≤
‚îú‚îÄ‚îÄ progress/             # –¢–µ—Å—Ç—ã –¥–ª—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
‚îÇ   ‚îú‚îÄ‚îÄ progress.test.ts
‚îÇ   ‚îî‚îÄ‚îÄ ...
‚îî‚îÄ‚îÄ ...                   # –î—Ä—É–≥–∏–µ –º–æ–¥—É–ª–∏
```

### Setup —Ñ–∞–π–ª–∞

`tests/setup.ts` —Å–æ–¥–µ—Ä–∂–∏—Ç –≥–ª–æ–±–∞–ª—å–Ω—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é:

- –û—á–∏—Å—Ç–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –ø–µ—Ä–µ–¥ –∫–∞–∂–¥—ã–º —Ç–µ—Å—Ç–æ–º
- –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è
- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Prisma –∫–ª–∏–µ–Ω—Ç–∞ –¥–ª—è —Ç–µ—Å—Ç–æ–≤

## –¢–∏–ø—ã —Ç–µ—Å—Ç–æ–≤

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã

- **API —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã**: –ü—Ä–æ–≤–µ—Ä–∫–∞ HTTP –∑–∞–ø—Ä–æ—Å–æ–≤ –∏ –æ—Ç–≤–µ—Ç–æ–≤
- **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö**: –í–∞–ª–∏–¥–∞—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∏—è, —á—Ç–µ–Ω–∏—è, –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
- **–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è**: –ü—Ä–æ–≤–µ—Ä–∫–∞ JWT —Ç–æ–∫–µ–Ω–æ–≤ –∏ —Ä–æ–ª–µ–π
- **–í–∞–ª–∏–¥–∞—Ü–∏—è**: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ Zod —Å—Ö–µ–º
- **–§–∞–π–ª–æ–≤—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏**: –ó–∞–≥—Ä—É–∑–∫–∞ –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π

### –ü—Ä–∏–º–µ—Ä—ã —Ç–µ—Å—Ç–æ–≤

#### –¢–µ—Å—Ç —Å–æ–∑–¥–∞–Ω–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å-–æ—Ç—á–µ—Ç–∞

```typescript
describe('POST /api/progress/new-report', () => {
	it('should create new progress report', async () => {
		const response = await app.inject({
			method: 'POST',
			url: '/api/progress/new-report',
			payload: {
				weight: 75,
				height: 175,
				photos: [
					/* mock files */
				],
			},
			headers: { authorization: `Bearer ${accessToken}` },
		})

		expect(response.statusCode).toBe(201)
		expect(response.json()).toHaveProperty('id')
	})
})
```

## –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ç–µ—Å—Ç–æ–≤–æ–π —Å—Ä–µ–¥—ã

1. **–°–∫–∞—á–∞—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:**

   ```bash
   npm install
   ```

2. **–°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—É—é –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö:**

   - –í pgAdmin —Å–æ–∑–¥–∞—Ç—å –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö `fitness_test`

3. **–ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏ –∫ —Ç–µ—Å—Ç–æ–≤–æ–π –ë–î:**

   ```bash
   npx dotenv -e .env.test -- npx prisma migrate deploy
   ```

4. **–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å Prisma Client:**
   ```bash
   npx prisma generate
   ```

### Vitest –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

–§–∞–π–ª `vitest.config.ts`:

```typescript
/// <reference types="vitest" />
import { defineConfig } from 'vite'

export default defineConfig({
	test: {
		globals: true,
		environment: 'node',
		setupFiles: ['./tests/setup.ts'],
		coverage: {
			provider: 'v8',
			reporter: ['text', 'json', 'html'],
			exclude: ['node_modules/', 'tests/'],
		},
	},
})
```

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –¥–ª—è —Ç–µ—Å—Ç–æ–≤

–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–π `.env.test` —Ñ–∞–π–ª:

```env
DATABASE_URL="postgresql://user:password@localhost:5432/fitness_test"
JWT_SECRET="test_jwt_secret"
```

_–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ: –î–ª—è –ª–æ–∫–∞–ª—å–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤ Supabase –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –Ω–µ —Ç—Ä–µ–±—É—é—Ç—Å—è, —Ç–∞–∫ –∫–∞–∫ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–∞—è —Ñ–∞–π–ª–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Ñ–∞–π–ª–æ–≤._

## –õ—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏

### –ù–∞–ø–∏—Å–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤

1. **–ò–∑–æ–ª—è—Ü–∏—è**: –ö–∞–∂–¥—ã–π —Ç–µ—Å—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –æ—Ç–¥–µ–ª—å–Ω—É—é —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é –ë–î
2. **–ú–æ–∫–∏**: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–æ–∫–∏ –¥–ª—è –≤–Ω–µ—à–Ω–∏—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π (Supabase, email)
3. **–§–∞–±—Ä–∏–∫–∏**: –°–æ–∑–¥–∞–≤–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ —á–µ—Ä–µ–∑ —Ñ–∞–±—Ä–∏–∫–∏
4. **–û—á–∏—Å—Ç–∫–∞**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ —Ç–µ—Å—Ç–∞

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ —Ñ–∞–π–ª–∞

```typescript
import { describe, it, expect, beforeEach } from 'vitest'
import { app } from '../app'

describe('Progress API', () => {
	let accessToken: string

	beforeEach(async () => {
		// Setup test data and authentication
	})

	describe('GET /api/progress/latest', () => {
		it('should return latest progress report', async () => {
			// Test implementation
		})
	})
})
```

## –ü–æ–∫—Ä—ã—Ç–∏–µ –∫–æ–¥–∞

### –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç—á–µ—Ç–∞

```bash
npm run test:coverage
```

–û—Ç—á–µ—Ç –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –≤ –ø–∞–ø–∫–µ `coverage/` —Å HTML –≤–µ—Ä—Å–∏–µ–π –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –≤ –±—Ä–∞—É–∑–µ—Ä–µ.

### –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

- **Statements**: > 80%
- **Branches**: > 75%
- **Functions**: > 85%
- **Lines**: > 80%

## CI/CD –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

–¢–µ—Å—Ç—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è –≤ CI/CD –ø–∞–π–ø–ª–∞–π–Ω–µ:

- –ù–∞ –∫–∞–∂–¥—ã–π PR
- –ü–µ—Ä–µ–¥ –¥–µ–ø–ª–æ–µ–º –≤ –ø—Ä–æ–¥–∞–∫—à–Ω
- –° –≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π –æ—Ç—á–µ—Ç–∞ –æ –ø–æ–∫—Ä—ã—Ç–∏–∏

## Troubleshooting

### –†–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

1. **–¢–∞–π–º–∞—É—Ç—ã —Ç–µ—Å—Ç–æ–≤**: –£–≤–µ–ª–∏—á–∏—Ç—å timeout –≤ vitest.config.ts
2. **–ü—Ä–æ–±–ª–µ–º—ã —Å –ë–î**: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∏ –æ—á–∏—Å—Ç–∫—É –¥–∞–Ω–Ω—ã—Ö
3. **–ú–æ–∫–∏ —Ñ–∞–π–ª–æ–≤**: –ü—Ä–∞–≤–∏–ª—å–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å multipart/form-data –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏

### –û—Ç–ª–∞–¥–∫–∞

```bash
# –ó–∞–ø—É—Å–∫ —Å –æ—Ç–ª–∞–¥–∫–æ–π
npm run test -- --reporter=verbose

# –ó–∞–ø—É—Å–∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Ç–µ—Å—Ç–∞ –≤ debug —Ä–µ–∂–∏–º–µ
npm run test -- --inspect-brk tests/progress/progress.test.ts
```
